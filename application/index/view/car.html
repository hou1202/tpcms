
<!--引入头部文件-->
{include file="default/header" title="购物车" keywords="Aoogi商城系统"}

{load href="/static/index/css/car.css" /}

<!--购物车列表模块-->
<div class="car">
    <div class="car-title">
        <p>共计 <span>2</span> 商品</p>
    </div>
    <form id="carFrom">
        <div class="car-list">
            <div class="car-list-box">
                <div class="car-list-select">
                    <input type="checkbox" name="id" value="1" class="selectInput">
                    <div class="list-select-box"></div>
                </div>
                <div class="car-list-img">
                    <img src="/static/index/images/goods1.jpg">
                </div>
                <div class="car-list-cont">
                    <div class="list-cont-title">
                        <h2>小米 MIX2 为发烧的你而做</h2>
                        <p>￥<span class="goodsPrice">2500</span></p>
                        <p>库存：<span class="goodsStock">1000</span></p>
                    </div>
                    <div class="list-cont-num">
                        <i class="cont-num-icon icon-left"></i>
                        <input type="number" name="" value="1" class="goodsNum" min="1" max="300" />
                        <i class="cont-num-icon icon-right"></i>
                    </div>
                </div>

            </div>
            <div class="car-list-del">
                删除
            </div>
        </div>

        <div class="car-list">
            <div class="car-list-box">
                <div class="car-list-select">
                    <input type="checkbox" name="id" value="2" class="selectInput">
                    <div class="list-select-box"></div>
                </div>
                <div class="car-list-img">
                    <img src="/static/index/images/goods1.jpg">
                </div>
                <div class="car-list-cont">
                    <div class="list-cont-title">
                        <h2>小米 MIX2 为发烧的你而做</h2>
                        <p>￥<span class="goodsPrice">3000</span></p>
                        <p>库存：<span class="goodsStock">800</span></p>
                    </div>
                    <div class="list-cont-num">
                        <i class="cont-num-icon icon-left"></i>
                        <input type="text" name="" value="1" class="goodsNum">
                        <i class="cont-num-icon icon-right"></i>
                    </div>
                </div>

            </div>
            <div class="car-list-del">
                删除
            </div>
        </div>

        <div class="car-list">
            <div class="car-list-box">
                <div class="car-list-select">
                    <input type="checkbox" name="id" value="2" class="selectInput">
                    <div class="list-select-box"></div>
                </div>
                <div class="car-list-img">
                    <img src="/static/index/images/goods1.jpg">
                </div>
                <div class="car-list-cont">
                    <div class="list-cont-title">
                        <h2>小米 MIX2 为发烧的你而做</h2>
                        <p>￥<span class="goodsPrice">3000</span></p>
                        <p>库存：<span class="goodsStock">800</span></p>
                    </div>
                    <div class="list-cont-num">
                        <i class="cont-num-icon icon-left"></i>
                        <input type="text" name="" value="1" class="goodsNum">
                        <i class="cont-num-icon icon-right"></i>
                    </div>
                </div>
            </div>
            <div class="car-list-del">
                删除
            </div>
        </div>

        <div class="car-list">
            <div class="car-list-box">
                <div class="car-list-select">
                    <input type="checkbox" name="id" value="2" class="selectInput">
                    <div class="list-select-box"></div>
                </div>
                <div class="car-list-img">
                    <img src="/static/index/images/goods1.jpg">
                </div>
                <div class="car-list-cont">
                    <div class="list-cont-title">
                        <h2>小米 MIX2 为发烧的你而做</h2>
                        <p>￥<span class="goodsPrice">3000</span></p>
                        <p>库存：<span class="goodsStock">800</span></p>
                    </div>
                    <div class="list-cont-num">
                        <i class="cont-num-icon icon-left"></i>
                        <input type="text" name="" value="1" class="goodsNum">
                        <i class="cont-num-icon icon-right"></i>
                    </div>
                </div>
            </div>
            <div class="car-list-del">
                删除
            </div>
        </div>
    </form>

    <!--购物车为空-->
    <!--<div class="car-null">
        <img src="/static/index/images/null.png">
    </div>-->
</div>

<!--购物车结算模块-->
<div class="balance">
    <div class="balance-all">
        <div class="balance-all-box"></div>
    </div>
    <div class="balance-sum">
        <p>合计：<span class="periceSum">0.00</span></p>
    </div>
    <div class="balance-button">
        <button type="button" id="submitForm" form="carForm"> 结 算 </button>
    </div>

</div>



<!--引入加载footer文件-->
{include file="default/footer" /}

<script>

    /*变量定义
    * var   price       string    单个商品价格
    * var   priceObj    obj       商品价格对象
    * var   sumPrice    string    商品总价格
    * var   sumObj      obj       商品总价格对象
    * var   num         string    单个商品数量
    * var   numObj      obj       商品数量对象
    * var   stock       string    单个商品库存
    * */

    /*购物车列表产品单个状态操作*/
    $(".list-select-box").click(function(){
        $(this).toggleClass('select-box-active');
        var sumObj = $(".periceSum");                                           //商品总价格对象
        var price = $(this).parent().parent().find(".goodsPrice").text();       //操作商品单价
        var numObj = $(this).parent().parent().find(".goodsNum");               //操作商品数量对象
        if($(this).hasClass('select-box-active')){
            //选中
            $(this).prev().attr("checked", true);
            sumObj.text(parseInt(sumObj.text())+parseInt(price)*numObj.val());
            numObj.attr('name','num');
        }else{
            //取消
            $(this).prev().attr("checked", false);
            $(".balance-all-box").removeClass('all-box-active');
            var sumPrice =parseInt(sumObj.text())-parseInt(price)*numObj.val();
            if(sumPrice < 0) sumPrice = 0.00;
            sumObj.text(sumPrice);
            numObj.attr('name','');

        }
    });
    /*购物车列表产品全选状态操作*/
    $(".balance-all-box").click(function(){
        $(this).toggleClass('all-box-active');
        if($(this).hasClass('all-box-active')){
            //选中
            $(".list-select-box").addClass('select-box-active');
            $(".selectInput").attr("checked", true);
            var priceObj = $(".goodsPrice");
            var sumPrice = 0.00;
            if(priceObj.length <= 0 ) return false;
            for(i = 0 ; i < priceObj.length ; i++){
                var num = 1;
                num = priceObj[i].parentNode.parentNode.nextElementSibling.children[1].value;
                sumPrice = sumPrice+parseInt(priceObj[i].textContent)*parseInt(num);
            }
            $(".periceSum").text(sumPrice);
            $(".goodsNum").attr('name','num');

        }else{
            //取消
            $(".list-select-box").removeClass('select-box-active');
            $(".selectInput").attr("checked", false);
            $(".periceSum").text("0.00");
            $(".goodsNum").attr('name','');
        }
    });

    /*购物数量减法控制*/
    $(".icon-left").click(function(){
        var numObj = $(this).next();            //商品数量对象
        if(parseInt(numObj.val()) <= 1 ) return autoAlert('已经不能再少了');
        $(numObj).val(numObj.val()-1);
        if($(this).parent().parent().prev().prev().find(".list-select-box").hasClass("select-box-active")){
            var sumObj = $(".periceSum");
            sumObj.text(parseInt(sumObj.text())-parseInt($(this).parent().prev().find('.goodsPrice').text()));
        }

    });
    /*购物数量加法控制*/
    $(".icon-right").click(function(){
        var numObj = $(this).prev();            //商品数量对象
        var stock = parseInt($(this).parent().prev().children().find(".goodsStock").text());        //商品库存
        if(parseInt(numObj.val()) < 0 ) return $(numObj).val(1);
        if(parseInt(numObj.val())+1 > stock) return autoAlert('真的不能再多了');
            $(numObj).val(parseInt(numObj.val())+1);
            if($(this).parent().parent().prev().prev().find(".list-select-box").hasClass("select-box-active")){
                var sumObj = $(".periceSum");
                sumObj.text(parseInt(sumObj.text())+parseInt($(this).parent().prev().find('.goodsPrice').text()));
            }
    });
    /*购物数量输入合法性判断*/
    $(".goodsNum").blur(function(){
        var reg = /^[1-9]+[0-9]*$/;
        var stock = parseInt($(this).parent().prev().children().find(".goodsStock").text());
        if(!reg.test($(this).val())) return $(this).val(1);
        if(parseInt($(this).val()) > stock) $(this).val(parseInt(stock));
        if($(this).parent().parent().prev().prev().find(".list-select-box").hasClass("select-box-active")){
            var priceObj = $(".select-box-active").parent().next().next().find(".goodsPrice");

            var sumPrice = 0;
            for(i = 0 ; i < priceObj.length ; i++){
                var num = 1;
                num = priceObj[i].parentNode.parentNode.nextElementSibling.children[1].value;
                sumPrice = sumPrice+parseInt(priceObj[i].textContent)*parseInt(num);
            }
            $(".periceSum").text(sumPrice);
        }
    });

    $("#submitForm").click(function(){
        window.location.href="/pay";
       //console.log($("#carFrom").serialize()) ;
       //console.log($("#carFrom").serializeArray()) ;
    });




</script>
<script>

    /*触屏横向滑动控制*/

    var mybody = document.getElementsByTagName('body')[0];
    var h = document.documentElement.clientHeight;
    mybody.style.height = h + 'px';

    //滑动处理
    var startX, startY, moveEndX, moveEndY, X, Y;
    var exist = false;
    var $that;

    mybody.addEventListener('touchstart', function(e) {
        // 判断默认行为是否可以被禁用
        if (e.cancelable) {
            // 判断默认行为是否已经被禁用
            if (!e.defaultPrevented) {
                e.preventDefault();
            }
        }
        //e.preventDefault();
        startX = e.touches[0].pageX;
        startY = e.touches[0].pageY;
        //var classPath = e.path;


        $(e.path).each(function (index,element) {
            if(e.path[index].className == 'car-list-box' || e.path[index].className == 'car-list-box box-active'){
                exist = true;
                $that = $(e.path[index]);


            }
        });


    }, false);

    mybody.addEventListener('touchmove', function(e) {

        // 判断默认行为是否可以被禁用
        if (e.cancelable) {
            // 判断默认行为是否已经被禁用
            if (!e.defaultPrevented) {
                e.preventDefault();
            }
        }

        moveEndX = e.changedTouches[0].pageX;

        moveEndY = e.changedTouches[0].pageY;

        X = moveEndX - startX;

        Y = moveEndY - startY;


        /*向右滑动*/
        if ( Math.abs(X) > Math.abs(Y) && X > 0 ) {
            if(exist){
                //console.log($that);
                $that.removeClass("box-active");
                $that.next('.car-list-del').fadeOut(300);
                $that='';
                exist = false;

            }
         }

        /*向左滑动*/
        if ( Math.abs(X) > Math.abs(Y) && X < 0 ) {
            if(exist){
                $that.addClass("box-active");
                $that.next('.car-list-del').fadeIn(300);
                $that='';
                exist = false;

            }
        }

        /*if ( Math.abs(Y) > Math.abs(X) && Y > 0) {

         console.log("向下");

         }*/

        /*if ( Math.abs(Y) > Math.abs(X) && Y < 0 ) {

         console.log("向上");

         }*/

        /*else{

         console.log("没滑动");

         }*/

    },false );
</script>

</html>