
<!--引入头部文件-->
{include file="default/header" title="订单结算" keywords="Aoogi商城系统"}

{load href="/static/index/css/order.css" /}
{load href="/static/index/lib/swiper-4.3.3.min.css" /}


<!--头部标题模块-->
<header class="header-title">
    <a href="Javascript:history.go(-1);">
        <img src="/static/index/images/back.png">
    </a>
    <h2>订单结算</h2>
</header>


<!--结算模块-->
<div class="order">
    <!--结算地址-->
    <div class="order-address">
        <div class="address-info">
            <div class="address-title">
                <p>收货人： <span>李白是一个诗人，一个好诗人</span></p>
                <p><span>13564078415</span></p>
            </div>
            <div class="address-posit">
                <div class="address-posit-img">
                    <img src="/static/index/images/address.png">
                </div>
                <div class="address-posit-info">
                    <p>安徽省 . 合肥市 . 蜀山区</p>
                    <p>望江西路亚夏汽车大楼1902室sgdgsfdgsdfgsdfgsdgs</p>
                </div>


            </div>
        </div>
        <!--<div class="address-null">
            添加购物地址 ....
        </div>-->
        <div class="address-select">
            <img src="/static/index/images/open.png">
        </div>
    </div>

    <!--结算产品-->
    <div class="order-goods">
        <div class="order-goods-list">
            <div class="goods-list-img">
                <img src="/static/index/images/goods1.jpg">
            </div>
            <div class="goods-list-cont">
                <h2>小米 MIX2 为发烧的你而做</h2>
                <div class="list-cont-param">
                    <p>移动版</span></p>
                    <p>￥2500.00</p>
                </div>
                <div class="list-cont-num">
                    x 1
                </div>
            </div>
        </div>
        <div class="order-goods-list">
            <div class="goods-list-img">
                <img src="/static/index/images/goods1.jpg">
            </div>
            <div class="goods-list-cont">
                <h2>小米 MIX2 为发烧的你而做</h2>
                <div class="list-cont-param">
                    <p>移动版</span></p>
                    <p>￥2500.00</p>
                </div>
                <div class="list-cont-num">
                    x 1
                </div>
            </div>
        </div>
        <div class="order-goods-list">
            <div class="goods-list-img">
                <img src="/static/index/images/goods1.jpg">
            </div>
            <div class="goods-list-cont">
                <h2>小米 MIX2 为发烧的你而做</h2>
                <div class="list-cont-param">
                    <p>移动版</span></p>
                    <p>￥2500.00</p>
                </div>
                <div class="list-cont-num">
                    x 1
                </div>
            </div>
        </div>
    </div>
</div>


<!--购物车结算模块-->
<div class="balance">
    <div class="balance-all">
        <div class="balance-all-box"></div>
    </div>
    <div class="balance-sum">
        <p>合计：<span class="periceSum">0.00</span></p>
    </div>
    <div class="balance-button">
        <button type="button" id="submitForm" form="carForm"> 结 算 </button>
    </div>

</div>



<!--引入加载footer文件-->
{include file="default/footer" /}

{load href="/static/index/lib/swiper-4.3.3.min.js" /}
{load href="/static/index/js/public.js" /}

<script>
    var mySwiper = new Swiper('.swiper-container', {
        //direction: 'vertical',
        slidesPerView: "auto",
        loop: true,
        effect:'coverflow',
        autoplay: true,
    });

    /*变量定义
    * var   price       string    单个商品价格
    * var   priceObj    obj       商品价格对象
    * var   sumPrice    string    商品总价格
    * var   sumObj      obj       商品总价格对象
    * var   num         string    单个商品数量
    * var   numObj      obj       商品数量对象
    * var   stock       string    单个商品库存
    * */

    /*购物车列表产品单个状态操作*/
    $(".list-select-box").click(function(){
        $(this).toggleClass('select-box-active');
        var sumObj = $(".periceSum");                                           //商品总价格对象
        var price = $(this).parent().parent().find(".goodsPrice").text();       //操作商品单价
        var numObj = $(this).parent().parent().find(".goodsNum");               //操作商品数量对象
        if($(this).hasClass('select-box-active')){
            //选中
            $(this).prev().attr("checked", true);
            sumObj.text(parseInt(sumObj.text())+parseInt(price)*numObj.val());
            numObj.attr('name','num');
        }else{
            //取消
            $(this).prev().attr("checked", false);
            $(".balance-all-box").removeClass('all-box-active');
            var sumPrice =parseInt(sumObj.text())-parseInt(price)*numObj.val();
            if(sumPrice < 0) sumPrice = 0.00;
            sumObj.text(sumPrice);
            numObj.attr('name','');

        }
    });
    /*购物车列表产品全选状态操作*/
    $(".balance-all-box").click(function(){
        $(this).toggleClass('all-box-active');
        if($(this).hasClass('all-box-active')){
            //选中
            $(".list-select-box").addClass('select-box-active');
            $(".selectInput").attr("checked", true);
            var priceObj = $(".goodsPrice");
            var sumPrice = 0.00;
            if(priceObj.length <= 0 ) return false;
            for(i = 0 ; i < priceObj.length ; i++){
                var num = 1;
                num = priceObj[i].parentNode.parentNode.nextElementSibling.children[1].value;
                sumPrice = sumPrice+parseInt(priceObj[i].textContent)*parseInt(num);
            }
            $(".periceSum").text(sumPrice);
            $(".goodsNum").attr('name','num');

        }else{
            //取消
            $(".list-select-box").removeClass('select-box-active');
            $(".selectInput").attr("checked", false);
            $(".periceSum").text("0.00");
            $(".goodsNum").attr('name','');
        }
    });

    /*购物数量减法控制*/
    $(".icon-left").click(function(){
        var numObj = $(this).next();            //商品数量对象
        if(parseInt(numObj.val()) <= 1 ) return autoAlert('已经不能再少了');
        $(numObj).val(numObj.val()-1);
        if($(this).parent().parent().prev().prev().find(".list-select-box").hasClass("select-box-active")){
            var sumObj = $(".periceSum");
            sumObj.text(parseInt(sumObj.text())-parseInt($(this).parent().prev().find('.goodsPrice').text()));
        }

    });
    /*购物数量加法控制*/
    $(".icon-right").click(function(){
        var numObj = $(this).prev();            //商品数量对象
        var stock = parseInt($(this).parent().prev().children().find(".goodsStock").text());        //商品库存
        if(parseInt(numObj.val()) < 0 ) return $(numObj).val(1);
        if(parseInt(numObj.val())+1 > stock) return autoAlert('真的不能再多了');
            $(numObj).val(parseInt(numObj.val())+1);
            if($(this).parent().parent().prev().prev().find(".list-select-box").hasClass("select-box-active")){
                var sumObj = $(".periceSum");
                sumObj.text(parseInt(sumObj.text())+parseInt($(this).parent().prev().find('.goodsPrice').text()));
            }
    });
    /*购物数量输入合法性判断*/
    $(".goodsNum").blur(function(){
        var reg = /^[1-9]+[0-9]*$/;
        var stock = parseInt($(this).parent().prev().children().find(".goodsStock").text());
        if(!reg.test($(this).val())) return $(this).val(1);
        if(parseInt($(this).val()) > stock) $(this).val(parseInt(stock));
        if($(this).parent().parent().prev().prev().find(".list-select-box").hasClass("select-box-active")){
            var priceObj = $(".select-box-active").parent().next().next().find(".goodsPrice");

            var sumPrice = 0;
            for(i = 0 ; i < priceObj.length ; i++){
                var num = 1;
                num = priceObj[i].parentNode.parentNode.nextElementSibling.children[1].value;
                sumPrice = sumPrice+parseInt(priceObj[i].textContent)*parseInt(num);
            }
            $(".periceSum").text(sumPrice);
        }
    });

    $("#submitForm").click(function(){
       console.log($("#carFrom").serialize()) ;
       //console.log($("#carFrom").serializeArray()) ;
    });

</script>

</html>